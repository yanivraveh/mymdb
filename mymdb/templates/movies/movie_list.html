{% extends "base.html" %}
{% block title %}Movies · MyMDB{% endblock %}

{% block content %}

<form method="get" class="toolbar">
  <label >Sort:</label>
  <select name="sort" onchange="this.form.submit()">
    <option value="newest"     {% if sort_key == "newest" %}selected{% endif %}>Newest</option>
    <option value="title_asc"  {% if sort_key == "title_asc" %}selected{% endif %}>Title (A–Z)</option>
    <option value="title_desc" {% if sort_key == "title_desc" %}selected{% endif %}>Title (Z–A)</option>
    <option value="year_asc"   {% if sort_key == "year_asc" %}selected{% endif %}>Year (oldest)</option>
    <option value="year_desc"  {% if sort_key == "year_desc" %}selected{% endif %}>Year (newest)</option>
  </select>

  {# preserve other filters later; page is intentionally omitted #}
  {% if base_qs %}
    {% for k,v in request.GET.items %}
      {% if k != 'sort' and k != 'page' %}
        <input type="hidden" name="{{ k }}" value="{{ v }}">
      {% endif %}
    {% endfor %}
  {% endif %}
</form>

<div class="grid">
  {% for movie in movies %}
    <a class="card" href="{% url 'movies:movie_details' movie.pk %}">
      {% if movie.poster %}
        <img src="{{ movie.poster.url }}" alt="{{ movie.title }} poster">
      {% endif %}
      <h3>{{ movie.title }}</h3>
      <p>{{ movie.description|truncatechars:140 }}</p>
      <small>{{ movie.release_year }}</small>
    </a>
  {% empty %}
    <p>No movies yet.</p>
  {% endfor %}
</div>

<nav class="pagination">
  {% if page_obj.has_previous %}
    <a class="pagination__link" href="?{{ base_qs }}{% if base_qs %}&{% endif %}page=1">
        <span class="d-xs-none">« First</span>
        <span class="d-sm-none">«</span>
    </a>
    <a class="pagination__link" href="?{{ base_qs }}{% if base_qs %}&{% endif %}page={{ page_obj.previous_page_number }}">
        <span class="d-xs-none">‹ Prev</span>
        <span class="d-sm-none">‹</span>
    </a>
  {% endif %}

  <span class="pagination__status">
      <span class="d-xs-none">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
      <span class="d-sm-none">{{ page_obj.number }}/{{ page_obj.paginator.num_pages }}</span>
  </span>

  {% if page_obj.has_next %}
    <a class="pagination__link" href="?{{ base_qs }}{% if base_qs %}&{% endif %}page={{ page_obj.next_page_number }}">
        <span class="d-xs-none">Next ›</span>
        <span class="d-sm-none">›</span>
    </a>
    <a class="pagination__link" href="?{{ base_qs }}{% if base_qs %}&{% endif %}page={{ page_obj.paginator.num_pages }}">
        <span class="d-xs-none">Last »</span>
        <span class="d-sm-none">»</span>
    </a>
  {% endif %}
</nav>

{% endblock %}
